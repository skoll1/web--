<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>csrf</h1>
    <p>攻击者盗用了你的身份，以你的名义发送恶意请求，盗取那个cookie来实现这个，主要包括，以你的名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币的转账等，造成个人隐私泄露，财产损失</p>
    <ul>
        <li>
            跨站请求伪造。
        </li>
        <li>
            虽然发送post回有跨域限制，但是我们可以使用js标签动态创建一个表单，然后把地址指向上述的url，最后自动提交
        </li>
        <li>
            node脚本攻击提交表单
        </li>
        <li>
            如果恶意用户能够知道网站管理后台某项功能的url，就可以直接攻击管理员，强迫管理员执行恶意用户定义的操作
        </li>
        <li>
            分类
            <ul>
                <li>
                    站内攻击：恶意用户指定自己的头像url是一个修改用户信息的连接，当其他已经登录的用户浏览恶意用户头像的时候，会自动想这个连接发送修改信息的请求
                </li>
                <li>
                    站外攻击：恶意用户在自己的服务器上，放置一个自动提交的表单，并把页面地址发送给受害者用户，受害者打开时，会发起一个请求。整个过程中，受害者用户仅仅看到一个空白的，甚至诱惑的页面，并且一直不知道自己的信息已经被修改了
                </li>
            </ul>
        </li>
    </ul>
    <h1>防范</h1>
    <ul>
        <li>
            验证码：应用程序和用户进行交互过程中，特别是账户交易这种核心操作，强制用户输入验证码，才能完成最终请求。虽然降低了用户的体验，但是可以很好地遏制csrf攻击，结论就是这个可以作为一种辅助手段，在关键业务设置验证码
        </li>
        <li>
            refer check。http refer是header的一部分，当浏览器向web服务器发送请求时，一般会带上refer信息告诉服务器是从哪个页面链接过来的，服务器以此可以获得一些信息用于信息处理，可以通过检查请求的来源来防御csrf攻击。正常请求的referer带有一定规律，如在提交表单的referer必定是在该页面发起的请求。所以检查http包头refer的值是不是这个页面，来判断是不是csrf攻击。
            <small>
                值得注意的是，在网站内部也是可以使用csrf攻击的，所以这个是不可靠的判断。
            </small>
        </li>
        <li>
            anti csrf token 。目前比较完善的解决方案是加入Anti-csrf-token,及发送请求的时候以参数形式随机加入一个token值，会进行校验该请求当中的token和cookie中的cookie是否存在且相等，菜户认为这是合法的请求
        </li>
        <li>
            值得注意的是，csrf防御是建立在XSS防御之后的，如果前一个出现了问题，那么后一个也无济于事
        </li>
        <li>
            所有表单修改用户个人信息的请求，都会受到csrf漏洞影响，如果一个表单功能只是查询，不会修改任何数据，就不会受到csrf攻击。
        </li>
    </ul>
</body>
</html>