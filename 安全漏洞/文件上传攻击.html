<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>web程序在处理用户上传文件时，没有判断文件的扩展名是否在允许的范围内，就把文件保存在服务器上，导致恶意用户可以上传任意文件，甚至上传脚本木马到web服务器上，直接控制web服务器</h1>
    <h1>解决方案</h1>
    <ul>
        <li>
            检查上传文件扩展白名单，不属于白名单内，不许上传
        </li>
        <li>
            上传文件的目录必须是http请求无法直接访问到的。如果需要访问，必须上传到和其他于明霞，并设值该目录为不解析js等脚本语言的目录
        </li>
        <li>
            上传文件要保存的文件名和目录名由系统根据时间生成，不允许用户自定义。
        </li>
        <li>
            图片上传，要通过处理，缩略图，水印，无异常才能保存到服务器。
        </li>
    </ul>
    <h1>文件下载威胁</h1>
    <ul>
        <li>
            任意文件下载攻击和目录遍历攻击
        </li>
        <li>
            如果让用户提交文件目录地址，就把目录下的文件列表发送给用户，会造成目录遍历安全威胁。
        </li>
        <li>
            恶意用户会变化目录或文件地址，下载服务器上的敏感文件，数据库链接配置文件，网站源代码等
        </li>
    </ul>
    <h2>解决方案</h2>
    <ul>
        <li>
            要下载的文件地址保存至数据库中。
        </li>
        <li>
            文件路径保存至数据库，让用户提交文件对应ID下载文件
        </li>
        <li>
            下载文件之前先做权限判断。
        </li>
        <li>
            文件放在web无法访问的目录下。
        </li>
        <li>
            不允许提供目录遍历服务。
        </li>
    </ul>
</body>
</html>